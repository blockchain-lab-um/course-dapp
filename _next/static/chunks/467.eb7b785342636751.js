(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{6451:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return q}});var r=n(7294),s=n(9499),a=n(29),o=n(7794),i=n.n(o),l=n(6489),c=n(1154),u=n(1360),d=n(241),x=n(7191),p=n(5893),h=function(e){return(0,x.Z)(e),(0,p.jsxs)("div",{className:"grid justify-items-center text-white bg-blue p-10 text-3xl font-semibold",children:[(0,p.jsx)("h1",{children:"You have successfuly completed the course! "}),(0,p.jsx)("h2",{children:"VC should appear in your wallet shortly!"})]})},m=n(1144),f=n.n(m);var b={name:"dclo7w",styles:"display:block;margin:0 auto;border-color:#05386b"},g=function(e){var t=e.loading,n=e.msg,s=(0,r.useState)("#05386b"),a=s[0];s[1];return(0,p.jsxs)("div",{className:"sweet-loading pt-5",children:[t&&(0,p.jsx)("div",{className:"text-blue p-3 text-2xl pb-6",children:n}),(0,p.jsx)(f(),{color:a,loading:t,css:b,size:100})]})},v=function(e){var t=e.connMetaMask;return(0,p.jsx)("div",{children:(0,p.jsx)("button",{className:"py-3 px-3 m-4 text-white text-3xl bg-blue hover:outline-blue hover:text-blue hover:bg-white outline outline-blue outline-8",onClick:t,children:"connect MetaMask"})})},j=function(e){var t=e.connected,n=e.address,r=e.connMetaMask;return(0,p.jsxs)("div",{className:"flex justify-between p-3",children:[(0,p.jsx)("div",{className:"text-blue text-6xl font-bold m-2",children:"Solidity Course"}),!t&&(0,p.jsx)(v,{connMetaMask:r}),t&&(0,p.jsx)("div",{className:"text-brown text-2xl font-bold m-2 p-5 bg-blue",children:(null===n||void 0===n?void 0:n.substring(0,10))+"..."})]})},w=function(e){var t=e.msg;return(0,p.jsx)("div",{className:"grid justify-items-center text-white bg-blue p-10 text-3xl font-semibold",children:(0,p.jsx)("h1",{children:t})})},k=function(e){var t=e.addAttribute;return(0,p.jsxs)("div",{className:"w-3/5",children:[(0,p.jsx)("div",{className:"grid justify-items-center bg-blue p-8",children:(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"text-3xl text-center text-white mb-10",children:"To ensure everything is working smoothly, additional DID delegate is required. To add delegate, add a custom attribute to your MetaMask account DID!"}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{})]})}),(0,p.jsx)("div",{className:"flex justify-center m-[-65px]",children:(0,p.jsx)("button",{className:"py-5 px-5 m-2 text-blue text-3xl bg-white hover:outline-green hover:bg-blue hover:text-white outline outline-blue outline-8",onClick:t,children:"add attribute"})})]})},y=function(e){var t=e.completeCourse,n=(0,r.useState)(""),s=n[0],a=n[1],o=(0,r.useState)(!1),i=o[0],l=o[1],c=function(e){l("true"===e.currentTarget.value)};return(0,p.jsx)("div",{className:"flex justify-center w-2/5 bg-blue text-white p-5 pt-10",children:(0,p.jsxs)("form",{onSubmit:function(e){e.preventDefault(),""==s||!1===i?console.log("Fill form first"):t(s),console.log("Name",s,i)},children:[(0,p.jsx)("div",{className:"text-4xl font-semibold",children:(0,p.jsxs)("label",{children:["NAME",(0,p.jsx)("input",{type:"text",name:"name",onChange:function(e){a(e.currentTarget.value)},className:"ml-2 pl-2 text-blue outline-none bg-white w-2/3"})]})}),(0,p.jsx)("br",{}),(0,p.jsx)("div",{className:"p-2 text-2xl",children:(0,p.jsxs)("label",{children:["Are you familiar with Solidity?",(0,p.jsxs)("div",{className:"pt-1",children:[(0,p.jsx)("input",{type:"radio",value:"true",name:"canProgram",onChange:c,className:"form-radio mr-2 text-green bg-white"})," ","Yes",(0,p.jsx)("input",{type:"radio",value:"false",name:"canProgram",onChange:c,className:"form-radio ml-4 text-green bg-white",defaultChecked:!0})," ","No"]})]})}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)("div",{className:"w-full flex justify-center",children:(0,p.jsx)("input",{className:"absolute mt-[-20px] py-2 px-5 m-2 text-blue text-3xl bg-white hover:outline-green hover:bg-blue hover:text-white outline outline-blue outline-8",type:"submit",value:"submit"})})]})})},C=n(6486),N=function(e){var t=e.switchView,n=function(e){e.preventDefault();var n=e.target.name;t((0,C.toNumber)(n))};return(0,p.jsxs)("div",{className:"w-full flex justify-start text-3xl pl-3 text-bold text-blue",children:[(0,p.jsx)("button",{className:"p-3 font-bold hover:text-white hover:bg-blue",onClick:n,name:"0",children:"Course"}),(0,p.jsx)("button",{className:"p-3 font-bold hover:text-white hover:bg-blue",onClick:n,name:"1",children:"Profile"})]})},S=function(e){var t=e.startCourse;return(0,p.jsxs)("div",{className:"w-3/5",children:[(0,p.jsx)("div",{className:"grid justify-items-center bg-blue p-8",children:(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"text-3xl text-center text-white mb-10",children:"Start the course to recieve your VC!"}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{})]})}),(0,p.jsx)("div",{className:"flex justify-center m-[-65px]",children:(0,p.jsx)("button",{className:"py-5 px-5 m-2 text-blue text-3xl bg-white hover:outline-green hover:bg-blue hover:text-white outline outline-blue outline-8",onClick:t,children:"start"})})]})},M=function(e){var t=e.VC,n=(0,r.useState)([]),s=n[0],a=n[1],o=(0,r.useState)(!1),i=o[0],l=o[1];(0,r.useEffect)((function(){var e=JSON.stringify(t.credentialSubject).substring(1,JSON.stringify(t.credentialSubject).length-1);a(e.split(",")),console.log(e)}),[]);var c=function(){l(!i)};return(0,p.jsxs)("div",{className:"grid bg-white p-3 max-w-xl break-all",children:[(0,p.jsx)("b",{children:"Issuer:"})," ",(0,p.jsx)("p",{children:t.issuer.id}),(0,p.jsx)("b",{children:"Subject:"}),(0,p.jsx)("div",{className:"p-2",children:s.map((function(e){return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("a",{children:e.toString()}),(0,p.jsx)("br",{})]})}))}),(0,p.jsx)("b",{children:"Issuance Date:"})," ",t.issuanceDate,(0,p.jsx)("br",{}),!i&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("b",{children:"Proof:"})," ",t.proof.jwt.substring(0,50),"..."]}),i&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("b",{children:"Proof:"})," ",t.proof.jwt]}),(0,p.jsx)("br",{}),!i&&(0,p.jsx)("button",{className:"text-xl text-blue",onClick:c,children:"More..."}),i&&(0,p.jsx)("button",{className:"text-xl text-blue",onClick:c,children:"Less..."})]})},D=function(e){var t=e.VCs;return(0,p.jsx)("div",{className:"w-full p-3 grid justify-center",children:t.map((function(e){return(0,p.jsx)(M,{VC:e})}))})},V=function(e){var t=e.mmAddress,n=(0,r.useState)([]),s=n[0],o=n[1];(0,r.useEffect)((function(){console.log("Getting VCs..."),l()}),[]);var l=function(){var e=(0,a.Z)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.ethereum.request({method:"wallet_invokeSnap",params:["npm:@blockchain-lab-um/ssi-snap",{method:"getVCs",params:[t]}]});case 3:n=e.sent,console.log(n),o(n.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return(0,p.jsxs)("div",{className:"w-full",children:[(0,p.jsx)("div",{className:"flex justify-center text-2xl font-bold",children:(0,p.jsx)("h1",{children:"My VCs"})}),(0,p.jsx)(D,{VCs:s})]})},A=function(e){var t=e.mmAddress,n=e.connectMetamask,r=e.spinner,s=e.courseCompleted,a=e.addEdKey,o=e.snapInitialized,i=e.edKey,l=e.hasVC,c=e.completeCourse,u=e.spinnerMsg,d=e.switchView,x=e.view,m=e.startCourse,f=e.courseStarted;return window.ethereum?(0,p.jsxs)("div",{children:[(0,p.jsx)(j,{address:t,connected:null!=t,connMetaMask:n}),(0,p.jsx)(N,{switchView:d}),0==x&&(0,p.jsxs)("div",{className:"flex justify-center pt-5",children:[null==t&&!r&&(0,p.jsx)("div",{className:"text-2xl pt-32",children:"Connect to the MetaMask to start the Course!"}),null!=t&&!r&&0==f&&(0,p.jsx)(S,{startCourse:m}),s&&f&&(0,p.jsx)(h,{}),null!=t&&!s&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(g,{loading:r,msg:u}),o&&!i&&!r&&f&&(0,p.jsx)(k,{addAttribute:a}),o&&o&&i&&!l&&!r&&(0,p.jsx)(y,{completeCourse:c}),o&&i&&l&&(0,p.jsx)(w,{msg:"You already have a valid VC!"})]})]}),1==x&&(0,p.jsxs)("div",{className:"flex justify-center pt-5",children:[null==t&&(0,p.jsx)("div",{className:"text-2xl pt-32",children:"Connect to the MetaMask to view Profile!"}),null!=t&&(0,p.jsx)(V,{mmAddress:t})]})]}):(0,p.jsx)(w,{msg:"MetaMask not installed!"})},P=n(9669),Z=new c.H2((0,u.jU)({rpcUrl:"https://rinkeby.infura.io/v3/6e751a2e5ff741e5a01eab15e4e4a88b",name:"rinkeby"})),I="npm:@blockchain-lab-um/ssi-snap",_="did:ethr:rinkeby:0x0241abd662da06d0af2f0152a80bc037f65a7f901160cfe1eb35ef3f0c532a2a4d",U=function(){var e=(0,r.useState)(null),t=e[0],n=e[1],o=(0,r.useState)(!0),c=(o[0],o[1],(0,r.useState)(!1)),u=c[0],x=c[1],h=(0,r.useState)(!1),m=h[0],f=h[1],b=(0,r.useState)(!1),g=b[0],v=b[1],j=(0,r.useState)(!1),w=j[0],k=j[1],y=(0,r.useState)("loading..."),C=y[0],N=y[1],S=(0,r.useState)(0),M=S[0],D=S[1],V=(0,r.useState)(!1),U=V[0],q=V[1],E=function(){var e=(0,a.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!window.ethereum){e.next=16;break}return window.ethereum.request({method:"eth_requestAccounts"}).then((function(e){console.log("Setting MM address!"),t=e[0],n(t)})),console.log("Checking for snap..."),e.next=6,O(I);case 6:if(!e.sent){e.next=10;break}console.log("Snap installed."),e.next=14;break;case 10:return e.next=12,R();case 12:e.sent||console.log("Something went wrong...");case 14:e.next=17;break;case 16:console.log("Install Metamask");case 17:return e.abrupt("return");case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t||0!=U){e.next=7;break}return console.log("Starting course..."),q(!0),e.next=5,J(t);case 5:return e.next=7,z(t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function T(){return F.apply(this,arguments)}function F(){return(F=(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.ethereum.request({method:"wallet_getSnaps"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return H.apply(this,arguments)}function H(){return(H=(0,a.Z)(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=console,e.next=3,T();case 3:return e.t1=e.sent,e.t0.log.call(e.t0,e.t1),e.prev=5,e.t2=Object,e.next=9,T();case 9:return e.t3=e.sent,e.abrupt("return",!!e.t2.values.call(e.t2,e.t3).find((function(e){return e.id===t&&(!n||e.version===n)})));case 13:return e.prev=13,e.t4=e.catch(5),console.log("Failed to obtain installed snaps",e.t4),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[5,13]])})))).apply(this,arguments)}var z=function(){var e=(0,a.Z)(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),N("checking for existing vc..."),console.log("Checking if user already has a valid VC.."),e.prev=3,e.next=6,window.ethereum.request({method:"wallet_invokeSnap",params:[I,{method:"getVCs"}]});case 6:n=e.sent,console.log(n);try{n.data.length>0&&n.data.map((function(e){console.log(e.credentialSubject.id.split(":")[3].toString().toUpperCase(),t,_.toUpperCase(),e.issuer.id.toString().toUpperCase()),e.credentialSubject.id.split(":")[3].toString().toUpperCase()===t.toUpperCase()&&e.issuer.id.toString().toUpperCase()===_.toUpperCase()&&(console.log("Valid VC found!"),k(!0))}))}catch(r){console.log("No valid VCs found!",r),f(!1),N("loading...")}e.next=17;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(e.t0),alert("Problem happened: "+e.t0.message||0),f(!1),N("loading...");case 17:f(!1),N("loading...");case 19:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=(0,a.Z)(i().mark((function e(n){var r,s,a,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new d.Q(window.ethereum),e.next=3,r.getNetwork();case 3:return s=e.sent.chainId,console.log(t,n,r,s),a=t,n&&(a=n),o=new l.h({identifier:a,provider:r,chainNameOrId:s}),e.next=10,Z.resolve(o.did);case 10:return c=e.sent.didDocument,console.log("DID:ETHR DID DOCUMENT:",c),e.next=14,r.getGasPrice();case 14:return e.t0=e.sent.toNumber(),u=2*e.t0,e.abrupt("return",{ethrDid:o,didDocument:c,gasPrice:u});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=(0,a.Z)(i().mark((function e(t,n){var r,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===t||void 0===t?void 0:t.verificationMethod,s=!1,null!=r&&(console.log("veri keys",r),r.map((function(e){var t;(null===(t=e.publicKeyHex)||void 0===t?void 0:t.toString().toUpperCase())===n.substring(2).toUpperCase()&&(s=!0)}))),e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),J=function(){var e=(0,a.Z)(i().mark((function e(t){var n,r,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Checking if key already exists..."),f(!0),N("checking for existing delegate..."),e.next=5,Y(t);case 5:return n=e.sent,n.ethrDid,r=n.didDocument,n.gasPrice,e.prev=9,console.log("requesting VC address"),e.next=13,window.ethereum.request({method:"wallet_invokeSnap",params:[I,{method:"getDIDAddress"}]});case 13:if(s=e.sent,console.log("Hex key:",s),!r||!s.data){e.next=20;break}return e.next=18,G(r,s.data);case 18:e.sent?(console.log("Key already exists!"),v(!0)):(console.log("Key not implemented yet"),v(!1));case 20:e.next=28;break;case 22:e.prev=22,e.t0=e.catch(9),console.error(e.t0),alert("Problem happened: "+e.t0.message||0),f(!1),N("loading...");case 28:f(!1),N("loading...");case 30:case"end":return e.stop()}}),e,null,[[9,22]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=(0,a.Z)(i().mark((function e(){var t,n,r,s,a,o,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Add key"),f(!0),N("preparing delegate..."),e.next=5,Y();case 5:return t=e.sent,n=t.ethrDid,r=t.didDocument,s=t.gasPrice,e.prev=9,e.next=12,window.ethereum.request({method:"wallet_invokeSnap",params:[I,{method:"getDIDAddress"}]});case 12:if(a=e.sent,console.log("Hex key:",a),!r){e.next=30;break}return e.next=17,G(r,a.data);case 17:if(e.sent){e.next=29;break}return 1e5,o={gasPrice:s,gasLimit:1e5},N("adding delegate..."),e.next=24,n.setAttribute("did/pub/Ed25519/veriKey/hex",a.data,86400,void 0,o);case 24:l=e.sent,console.log("Adding attribute res",l),l&&(console.log("Sucessfuly added Ed Key!"),v(!0)),e.next=30;break;case 29:console.log("Attribute already exists");case 30:e.next=38;break;case 32:e.prev=32,e.t0=e.catch(9),console.error(e.t0),alert("Problem happened: "+e.t0.message||0),f(!1),N("loading...");case 38:f(!1),N("loading...");case 40:case"end":return e.stop()}}),e,null,[[9,32]])})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=(0,a.Z)(i().mark((function e(n){var r,s,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n,"Completed the course!",t),r={headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}},s={name:n,id:"did:ethr:rinkeby:"+t},e.next=5,P.post("https://bclabum.informatika.uni-mb.si/ssi-demo-backend/api/vc/issue-vc",s,r).then((function(e){return e.data})).catch((function(e){console.log(e)}));case 5:return a=e.sent,console.log(a),e.prev=7,e.next=10,window.ethereum.request({method:"wallet_invokeSnap",params:[I,{method:"saveVC",params:[a]}]});case 10:o=e.sent,console.log(o),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),console.error(e.t0),alert("Problem happened: "+e.t0.message||0);case 18:x(!0);case 19:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,a.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),N("installing snap..."),e.next=4,window.ethereum.request({method:"wallet_enable",params:[{wallet_snap:(0,s.Z)({},I,{version:"latest"})}]});case 4:if(!(t=e.sent)){e.next=12;break}if(!t.snaps[I]){e.next=12;break}return console.log("Sucessfuly installed."),f(!1),N("loading..."),e.abrupt("return",!0);case 12:return f(!1),N("loading..."),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,p.jsx)(A,{mmAddress:t,connectMetamask:E,spinner:m,courseCompleted:u,addEdKey:L,snapInitialized:!0,edKey:g,hasVC:w,completeCourse:Q,spinnerMsg:C,switchView:function(e){M!=e&&D(e)},view:M,startCourse:K,courseStarted:U})};function q(){return(0,p.jsx)("div",{className:"bg-green min-h-screen font-mono",children:(0,p.jsx)(U,{})})}},5883:function(){},6601:function(){},9214:function(){}}]);